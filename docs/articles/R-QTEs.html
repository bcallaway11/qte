<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Quantile Treatment Effects in R: The qte Package • qte</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/sandstone/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Quantile Treatment Effects in R: The qte Package">
<meta property="og:description" content="qte">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">qte</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">1.4.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../articles/index.html">User Guides</a>
</li>
<li>
  <a href="../reference/index.html">Functions</a>
</li>
<li>
  <a href="../news/index.html">News</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="R-QTEs_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Quantile Treatment Effects in R: The qte Package</h1>
                        <h4 data-toc-skip class="author">Brantly Callaway</h4>
            
            <h4 data-toc-skip class="date">2023-02-15</h4>
      
      
      <div class="hidden name"><code>R-QTEs.Rmd</code></div>

    </div>

    
    
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>When evaluating the effect of a program, policymakers may be interested in more than just the average impact of the program. For example, there may be cases where the mean net impact (benefit minus cost) is negative, but the program is still implemented because of the distributional impacts of the program. One example from economics is the effect of a job training program. Consider two job training programs that both have the same mean net impact which is negative. If the first job training program tends to increase wages at the top of the wage distribution, it is likely to be rejected by policymakers. On the other hand, if the second job training program tends to increase wages at the bottom of the wage distribution, it may be approved by policymakers. Traditional methods, such as linear regression where the effect of participating in a program is constrained to be the same across all individuals are not suitable for distinguishing between these two types of programs. Neither are methods that allow for treatment effect heterogeneity but identify only the average effect of participating in a program. The distributional methods available in the R package QTE are useful in cases such as the above example where the researcher is interested in both allowing for treatment effect heterogeneity and understanding some aspect of the treatment effect heterogeneity.</p>
<p>The idea that participating in a program can have a different effect on even observationally identical individuals has a long history in the econometrics literature <span class="citation">(Heckman and Robb 1985)</span>. There has been much recent interest in studying treatment effect heterogeneity <span class="citation">(Heckman, Smith, and Clements 1997; Abbring and Heckman 2007)</span>. Although the QTE might not be the first choice parameter of interest for studying treatment effect heterogeneity, it is easier to identify as it only depends on the marginal distributions rather than the joint distribution. In some cases the QTE is identical to the Quantiles of the Treatment Effect <span class="citation">(Fan and Park 2009)</span> when individuals maintain their rank in the treated and untreated distributions and the QTE is increasing in <span class="math inline">\(\tau\)</span>. On the other hand, one can write down simply examples where the effect of treatment is heterogeneous across agents and the QTE is constant or where the QTE is not constant but there is no treatment effect heterogeneity.</p>
<p>This article deals with estimating QTEs in several situations that are likely to be common in applied research. Models where treatment is randomly assigned or <em>as good as random</em> after conditioning on some covariates.<a href="#fn1" class="footnote-ref" id="fnref1"><sup>1</sup></a> Methods for the case where the researcher has access to repeated cross sectional data or panel data are also available in the methods <code>panel.qtet</code> <span class="citation">(Callaway and Li 2019)</span>, <code>MDiD</code>, <code>QDiD</code>, and <code>CiC</code> <span class="citation">(Athey and Imbens 2006)</span>. It should also be mentioned that methods for estimating the QTE when identification is based on an instrumental variable <span class="citation">(Frolich and Melly 2013)</span> are not currently available in the <code>ci.qte</code> package though the author’s of that method do have some code available in <code>Stata</code> with the command <code>ivqte</code>.</p>
<p>Because the QTE and the Average Treatment Effect (ATE)<a href="#fn2" class="footnote-ref" id="fnref2"><sup>2</sup></a> (or the QTET and ATT) are both functions of the marginal distributions <span class="math inline">\(F_{Y_1}(y_1)\)</span> and <span class="math inline">\(F_{Y_0}(y_0)\)</span>, estimating the QTE implies the ATE can be recovered from it. Usually, the ATE is identified under weaker conditions than the QTE; e.g. the ATE usually requires some type of mean independence assumption while the QTE requires some type of full independence assumption. As such, researchers that study the QTE are usually interested in the shape of the QTE rather than the location as the location is already available under the weaker assumptions that identify the QTE. In the job training example, the ATE is useful for thinking about whether or not participating in a job training program tends to increase wages; the QTE is useful for thinking about whether the job training program affects wages of workers at the top of the wage distribution more or less than workers at the bottom of the wage distribution.</p>
</div>
<div class="section level2">
<h2 id="background-on-treatment-effects">Background on treatment effects<a class="anchor" aria-label="anchor" href="#background-on-treatment-effects"></a>
</h2>
<p>There is a large literature on treatment effects. <span class="citation">(Imbens and Wooldridge 2009)</span> provides a thorough introduction. The QTE package follows the most common setup. First, we are considering the case of a binary instrument. All individuals in the population either participate in the treatment or not. The set of participating individuals is called the treatment group; the set of non-participating individuals is called the untreated or control group.<br>
There are many examples of programs that fit into this category. The example that we use throughout this article is a job training program. We are interested in whether or not participating in a job training program has an effect on subsequent wages. There are many other examples in different fields. In medicine, one might be interested in studying the effect of a drug on some health outcome. In a randomized experiment, this evaluation is relatively easy. A more challenging example would be the effect of cigarette smoking on longevity. Because an individual cannot be randomly assigned to smoke, the researcher must invoke some assumption to identify an effect of smoking. In political science, an example would be the effect of being the incumbent on an election outcome.</p>
<div class="section level3">
<h3 id="notation">Notation<a class="anchor" aria-label="anchor" href="#notation"></a>
</h3>
<p>We use a common notation throughout the paper. Let <span class="math inline">\(Y_1\)</span> and <span class="math inline">\(Y_0\)</span> denote the potential treated outcome and potential untreated outcome for individual <span class="math inline">\(i\)</span> (the <span class="math inline">\(i\)</span> subscript is supressed throughout for notational simplicity), respectively. Let <span class="math inline">\(D\)</span> be a binary variable that takes the value 1 if an individual is treated and takes the value if the individual is untreated. For each individual, only one of the potential outcomes is observed. We denote the observed outcome <span class="math inline">\(Y\)</span> and note that it can be written as <span class="math inline">\(Y = D Y_1 + (1-D) Y_0\)</span>. In some cases, we may also observe some covariates <span class="math inline">\(X\)</span>. These covariates may affect both potential outcomes and the decision of whether or not to be treated.</p>
<p>The Difference in Differences models involve either repeated cross section or panel data and therefore, in those models, an additional subscript denoting time <span class="math inline">\(t\)</span> is required. The notation is otherwise the same except, for example, <span class="math inline">\(Y_{1t}\)</span> would denote the treated potential outcome at time <span class="math inline">\(t\)</span> and <span class="math inline">\(Y_{0t-1}\)</span> would denote the untreated potential outcome at time <span class="math inline">\(t-1\)</span>.</p>
</div>
</div>
<div class="section level2">
<h2 id="quantiles">Quantiles<a class="anchor" aria-label="anchor" href="#quantiles"></a>
</h2>
<p><img src="R-QTEs_files/figure-html/unnamed-chunk-2-1.png" width="90%" style="display: block; margin: auto;"></p>
<p><em>Figure 1: A plot of a standard normal distribution truncated from the left at zero. The lower dotted line represents the median; the upper dotted line represents the 95th percentile. The figure on the right inverts the same distribution to show the quantiles. Each dotted line once again corresponds to the median and the 95th percentile.</em></p>
<p>For a random variable <span class="math inline">\(Z\)</span> with distribution function <span class="math inline">\(F_Z(\cdot)\)</span>, the <span class="math inline">\(\tau\)</span>-th quantile, <span class="math inline">\(z_\tau\)</span> is defined as</p>
<p><span class="math display">\[z_\tau = \inf\{z : F_Z(z) \geq \tau\}\]</span></p>
<p>When <span class="math inline">\(Z\)</span> is continuously distributed, the definition can be simplified to</p>
<p><span class="math display">\[ z_\tau = F^{-1}_Z(\tau) \]</span></p>
<p>In either case, the quantile <span class="math inline">\(z_\tau\)</span> is identified whenever the distribution function <span class="math inline">\(F_Z(\cdot)\)</span> is identified.</p>
<p>Many quantiles are quite familiar. The 0.5-quantile is the median. The 0.25- and 0.75-quantiles are the 1st and 3rd quartile. The 0.01-, 0.02-, 0.03- are the 1st, 2nd, 3rd, and so on percentiles. Figure 1(a) plots the distribution function of random draws from a <span class="math inline">\(N(1,1)\)</span> distribution truncated at 0. From the distribution function, the <span class="math inline">\(\tau\)</span>-th quantile can be found by (i) finding <span class="math inline">\(\tau\)</span> on the y-axis, (ii) finding where a horizontal line from that point intersects the distribution function, and (iii) drawing a vertical line down to the y-axis. In Figure 1(a), this procedure is followed to find the median and the 95-th percentile of the distribution. In Figure 1(b), the entire distribution from Figure 1(a) is inverted to obtain all the quantiles. The dotted lines in Figure 1(b) correspond to the median and the 95-th percentile.</p>
</div>
<div class="section level2">
<h2 id="quantile-treatment-effects">Quantile Treatment Effects<a class="anchor" aria-label="anchor" href="#quantile-treatment-effects"></a>
</h2>
<p>QTEs are defined as the difference between the quantiles (for a particular value of <span class="math inline">\(\tau\)</span>) of the treated potential outcome distribution and the untreated potential outcome distribution.</p>
<p><img src="R-QTEs_files/figure-html/unnamed-chunk-3-1.png" width="90%" style="display: block; margin: auto;"></p>
<p><em>Figure 2: The figure is two cumulative distributions. The red distribution is the same truncated standard normal distribution as in Figure 1. The blue distribution is an adjusted truncated normal distribution. The lower dotted line represents the Quantile Treatment Effect for <span class="math inline">\(\tau = 0.5\)</span>; the upper dotted line represents the Quantile Treatment Effect for <span class="math inline">\(\tau = 0.95\)</span>. The figure on the right inverts both distribution functions and displays all the Quantile Treatment Effects for <span class="math inline">\(\tau \in [0,1]\)</span></em></p>
<p>For <span class="math inline">\(\tau \in [0,1]\)</span> <span class="math display">\[ QTE(\tau) = F^{-1}_{Y_1}(\tau) - F^{-1}_{Y_0}(\tau) \]</span> Likewise, QTETs are defined as the difference between the quantiles of (i) the distribution of treated potential outcomes for the treated group and (ii) the distribution of untreated potential outcomes for the treated group. <span class="math display">\[ QTET(\tau) = F^{-1}_{Y_1|D=1}(\tau) - F^{-1}_{Y_0|D=1}(\tau) \]</span> For identification, the key issue is whether or not each of the distributions are identified. For the QTE, some assumption needs to be invoked to identify both <span class="math inline">\(F_{Y_{1t}}(y_1)\)</span> and <span class="math inline">\(F_{Y_{0t}}(y_0)\)</span>. For the QTET, <span class="math inline">\(F_{Y_{1t}|D_t=1}(y_1)\)</span> is identified directly from the data because we observe at the distribution of treated outcomes for the treated group. However, to identify <span class="math inline">\(F_{Y_{0t}|D_t=1}(y_0)\)</span> will require some identifying assumption because we do not observe untreated potential outcomes for the treated group.</p>
<p>Figure 2 shows the QTE for two simulated distributions. The purple distribution in Figure 2(a) is the same as the distribution in Figure 1; the green distribution is an adjusted truncated normal distribution. The horizontal distance between the two distributions gives the QTE. For example, QTE(0.5) and QTE(0.95) are represented by the two dotted lines in the figure. The QTE for all values of <span class="math inline">\(\tau\)</span> is plotted in Figure 2(b).</p>
</div>
<div class="section level2">
<h2 id="identification-and-estimation">Identification and Estimation<a class="anchor" aria-label="anchor" href="#identification-and-estimation"></a>
</h2>
<p>This section covers identification and estimation under the most commonly invoked assumptions for identifying the QTE or QTET. But first, we give a brief description of the dataset used in the examples.</p>
<div class="section level3">
<h3 id="data">Data<a class="anchor" aria-label="anchor" href="#data"></a>
</h3>
<p>We use data from a job training program in the 1970s. This program provided extensive job training to workers over a 9-18 month period. The program randomly assigned some applicants to the program and randomly denied some other applicants. The dataset also includes non-experimental observations from the Panel Study of Income Dynamics (PSID). None of the individuals from the PSID participated in the job training program, but they can be combined with the treated group from the job training program to form an ``observational’’ dataset. Then, various techniques that can be applied in non-experimental settings can be applied to this new dataset, and the results can be compared to the results obtained from using the full experimental dataset as a check on the performance of various non-experimental methods <span class="citation">(LaLonde 1986)</span>. We use a subset that consists of males with three (2 pre-training and 1 post-training) years of earnings data (the outcome of interest). This subset has been considered in <span class="citation">(Dehejia and Wahba 1999; Smith and Todd 2005; Firpo 2007)</span>.</p>
</div>
<div class="section level3">
<h3 id="using-the-qte-package">Using the QTE package<a class="anchor" aria-label="anchor" href="#using-the-qte-package"></a>
</h3>
<p>After installing the <code>qte</code> package, the package can be loaded by</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">qte</span><span class="op">)</span></span></code></pre></div>
<p>and the job training datasets loaded by the following command</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">lalonde</span><span class="op">)</span></span></code></pre></div>
<p>which loads the four datasets <code>lalonde.exp</code>, <code>lalonde.psid</code>, <code>lalonde.exp.panel</code>, and <code>lalonde.psid.panel</code>. The <code>exp</code> datasets contain the experimental datasets, and the <code>psid</code> datasets contain the observational datsets. The two datasets with the suffix panel contain exactly the same data as their respective counterparts, but the data is formatted in a panel (three observations per individual in the dataset rather than one) to facilitate estimation using the Difference in Differences methods mentioned below.</p>
<p>The main methods in the <code>ci.qte</code> package are <code>ci.qte</code>, <code>ci.qtet</code>, <code>panel.qtet</code>, <code>QDiD</code>, <code>CiC</code>, and <code>MDiD</code>. These are useful for estimating the QTE and QTET and are each based on specific identifying assumptions (discussed in more detail below). Each method requires the user to supply a formula for the outcome on the treatment status, a vector of names of conditioning <span class="math inline">\(X\)</span> variables, and a data frame. The user should also specify for which values of <span class="math inline">\(\tau\)</span> the QTE or QTET should be calculated. There are other available parameters discussed in more detail in the manual. The most common uses are detailed in the rest of this section. Each method returns a <code>QTE</code> object. The <code>QTE</code> object contains the estimated QTE or QTET, ATE or ATT, and some other information such as standard errors and confidence intervals. Once a <code>QTE</code> object has been estimated, the user can call <code>summary</code> and <code>ggqte</code> methods to obtain results (a <code>plot</code> method is available, but we recommend the <code>ggqte</code> method for plotting which builds on the <code>ggplot2</code> package).</p>
</div>
<div class="section level3">
<h3 id="randomization">Randomization<a class="anchor" aria-label="anchor" href="#randomization"></a>
</h3>
<p>When an individual is randomly assigned to treatment, then QTE is identified. Random treatment assignment is common in medical studies. It is sometimes available in the social sciences in cases such as lab experiments, field experiments, and has sometimes been built into some programs such as job training. Randomization is sometimes called the “gold standard” of empirical research, but though there are some questions that randomization cannot answer and randomized experiments in practice may differ from randomized experiments in theory [<span class="citation">Heckman and Smith (1995)</span>; manski-1996]. For example, individuals may not comply with their random assignment.^[Without perfect compliance, the random assignment to the treated or untreated group can be used as an instrument for actual treatment status. This setup can lead to identification of the ATT <span class="citation">(Imbens and Angrist 1994} or a conditional QTET <span class="citation">[@abadie-angrist-imbens-2002]</span>. This approach is not currently available in the <code>QTE</code> package.)</span></p>
<p>Under randomization, the following independence condition holds <span class="math display">\[  (Y_1, Y_0) \perp D \]</span> Under this assumption, the marginal distributions <span class="math inline">\(F_{Y_1}(y_1)\)</span> and <span class="math inline">\(F_{Y_0}(y_0)\)</span> are both identified. The reason they are identified is that <span class="math inline">\(F_{Y_1}(y_1) = F_{Y|D=1}(y_1)\)</span> and <span class="math inline">\(F_{Y_0}(y_0) = F_{Y|D=0}(y_0)\)</span> under the above condition. And each of the two distributions <span class="math inline">\(F_{Y|D=1}(y_1)\)</span> and <span class="math inline">\(F_{Y|D=0}(y_1)\)</span> can be obtained by looking at the distribution of outcomes for the treated group and the untreated group, respectively. In other words, under randomization of treatment, the partially unobserved distribution of treated potential outcomes is the same as the fully observed distribution of realized outcomes for the treated group; and likewise, the partially unobserved distribution of untreated potential outcomes is the same as the fully observed distribution of realized outcomes for the untreated group.</p>
<div class="section level4">
<h4 id="estimation">Estimation<a class="anchor" aria-label="anchor" href="#estimation"></a>
</h4>
<p>Under randomization, the QTE can be easily esimated using the <code>ci.qte</code> command with no covariates. In this section, we use the experimental portion of the job training set. The <code>ci.qte</code> method also computes an estimate of the Average Treatment Effect as a byproduct.</p>
<p>In the case of the job training program, the parameter being identified is the QTET. Individuals who desired to be treated were randomized into or out of the program. To see this, let <span class="math inline">\(D^*\)</span> be a binary variable indicating whether an individual desires to be treated (<span class="math inline">\(D^*=1\)</span>) or does not desire to be treated (<span class="math inline">\(D^*=0\)</span>). Because individuals that do not desire to be treated never attempt to join the job training program, they cannot be randomized. Amongst those individuals who desire to be treated, some are assigned to the job training program (<span class="math inline">\(R=1\)</span>) and some are randomized out of the program (<span class="math inline">\(R=0\)</span>). Under this setup, <span class="math inline">\((Y_1, Y_0) \perp R | D^*=1\)</span>. The distribution <span class="math inline">\(F_{Y_{1}|D=1}(y_1) = F_{Y_{1}|D^*=1, R=1}(y_1)\)</span> is identifed using the outcomes from the group with <span class="math inline">\(D^*=1\)</span> and <span class="math inline">\(R=1\)</span>. The distribution <span class="math inline">\(F_{Y_{0}|D=1}(y_0) = F_{Y_{0}|D^*=1, R=1}(y_0) = F_{Y_{0}|D^*=1, R=0}(y_0)\)</span> where the last equality holds by the assumption. This last distribution can be constructed using observations of untreated outcomes for the group that was randomized out of treatment.</p>
<p>The results from the <code>ci.qte</code> or <code>ci.qtet</code> command will be identical in this case, but it is important to note what the correct interpretation of the results is. The QTET can be estimated with the following command</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">jt.rand</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ci.qtet.html">ci.qtet</a></span><span class="op">(</span><span class="va">re78</span> <span class="op">~</span> <span class="va">treat</span>, data<span class="op">=</span><span class="va">lalonde.exp</span>, probs<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0.05</span>,<span class="fl">0.95</span>,<span class="fl">0.05</span><span class="op">)</span>, </span>
<span> se<span class="op">=</span><span class="cn">T</span>, iters<span class="op">=</span><span class="fl">10</span><span class="op">)</span></span></code></pre></div>
<p>The <code>ci.qtet</code> command returns a <code>QTE</code> object</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/class.html" class="external-link">class</a></span><span class="op">(</span><span class="va">jt.rand</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "QTE"</span></span></code></pre>
<p>and the <code>summary</code> command provides the results</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">jt.rand</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## </span></span>
<span><span class="co">## Quantile Treatment Effect:</span></span>
<span><span class="co">##      </span></span>
<span><span class="co">## tau  QTE Std. Error</span></span>
<span><span class="co">## 0.05    0.00    0.00</span></span>
<span><span class="co">## 0.1     0.00    0.00</span></span>
<span><span class="co">## 0.15    0.00    0.00</span></span>
<span><span class="co">## 0.2     0.00  258.90</span></span>
<span><span class="co">## 0.25  338.65  385.30</span></span>
<span><span class="co">## 0.3   846.40  308.38</span></span>
<span><span class="co">## 0.35 1451.51  474.59</span></span>
<span><span class="co">## 0.4  1177.72  720.97</span></span>
<span><span class="co">## 0.45 1396.08  559.59</span></span>
<span><span class="co">## 0.5  1123.55  466.47</span></span>
<span><span class="co">## 0.55 1181.54  631.75</span></span>
<span><span class="co">## 0.6  1466.51  674.24</span></span>
<span><span class="co">## 0.65 2115.04  678.34</span></span>
<span><span class="co">## 0.7  1795.12 1076.19</span></span>
<span><span class="co">## 0.75 2347.49  669.07</span></span>
<span><span class="co">## 0.8  2278.12 1065.59</span></span>
<span><span class="co">## 0.85 2178.28  832.99</span></span>
<span><span class="co">## 0.9  3239.60 1625.80</span></span>
<span><span class="co">## 0.95 3979.62 1287.02</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Average Treatment Effect:    1794.34</span></span>
<span><span class="co">##   Std. Error:        345.35</span></span></code></pre>
<p>The QTET can also be plotted with the <code>ggqte</code> command.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/ggqte.html">ggqte</a></span><span class="op">(</span><span class="va">jt.rand</span><span class="op">)</span></span></code></pre></div>
<p><img src="R-QTEs_files/figure-html/unnamed-chunk-8-1.png" width="90%" style="display: block; margin: auto;"></p>
</div>
</div>
<div class="section level3">
<h3 id="conditional-independence-assumption">Conditional Independence Assumption<a class="anchor" aria-label="anchor" href="#conditional-independence-assumption"></a>
</h3>
<p>A second assumption that can be used to identify the QTE is the following</p>
<p><span class="math display">\[ (Y_1, Y_0) \perp D | X \]</span></p>
<p>were <span class="math inline">\(X\)</span> is a vector of covariates. This assumption says that after conditioning on these <span class="math inline">\(X\)</span> covariates, selection into treatment is as good as random. The Conditional Independence Assumption is sometimes also called Selection on Observables. In the example of the job training program, <span class="math inline">\(X\)</span> may contain variables such as age, education, and other background characteristics. In practice, under the Conditional Independence Assumption, individuals with ``similar’’ characteristics can be compared across treatment status to build potential outcome distributions. If individuals with the same covariates select into treatment based on the expected gain from treatment (e.g. if individuals that experience larger gains from job training are more likely to participate in job training than observationally similar individuals that would experience smaller gains), then this assumption is necessarily violated. Also, note that this assumption is a full independence assumption. It does identify the Average Treatment Effect, but the ATE can be identified under a weaker mean independence assumption.</p>
<p>When the researcher has access to panel data, lags of the outcome or lags of the other covariates could be included in <span class="math inline">\(X\)</span>. This may make the identifying assumption more plausible in applications. In the job training example <span class="math inline">\(X\)</span> could contain lags of earnings or unemployment histories which may be important to condition on to correctly evaluate job training programs <span class="citation">(Ashenfelter 1978; Heckman, Smith, and Clements 1997)</span>.</p>
<p>The Conditional Independence Assumption implies that the distributions <span class="math inline">\(F_{Y_1|X}(y_1)\)</span> and <span class="math inline">\(F_{Y_0|X}(y_0)\)</span> are identified. This follows because <span class="math inline">\(F_{Y_j|X}(y_j) = F_{Y_j|X,D=j}(y_j)\)</span> under the Conditional Independence Assumption, and the latter quantity can be obtained by calculating the conditional distribution of observed outcomes for members of each group. Then, <span class="math inline">\(F_{Y_0}(y_1)\)</span> and <span class="math inline">\(F_{Y_0}(y_0)\)</span> can be obtained by integrating out <span class="math inline">\(X\)</span>. For example,</p>
<p><span class="math display">\[ F_{Y_1}(y_1) = E_X[F_{Y_1|X}(y_1)] \]</span></p>
<p>This distribution can be easily inverted to obtain the quantiles. Although this identification result is straightforward, implementing it may be challenging in practice. The most natural estimator is <span class="math inline">\(\hat{F}_{Y_1}(y_1) = \frac{1}{n} \sum_{i=1}^n \hat{F}_{Y_1|X=X_i}(y_1)\)</span>. However, in general (for example when at least one of the elements of <span class="math inline">\(X\)</span> is continuous), an estimator for <span class="math inline">\(\hat{F}_{Y_1|X=x}(y_1)\)</span> will be computationally difficult as it requires some smoothing procedure such as kernel or series methods. These methods have the additional difficulty of requiring the researcher to choose a bandwidth in the case of kernels or the number of terms in the case of series methods.</p>
<p>Instead, the <code>QTE</code> package implements the propensity score re-weighting approach developed in <span class="citation">(Firpo 2007)</span>. The propensity score is <span class="math inline">\(p(x) = P(D=1|X=x)\)</span>, and the propensity score re-weighting approach rewrites <span class="math inline">\(E_X[F_{Y_1|X}(y_1)]\)</span> as a single unconditional moment that depends on <span class="math inline">\(y_1\)</span> and the propensity score. The propensity score is estimated in a first step and then a sum of weighted check functions is minimized in a second step to obtain an estimate of the QTET. This technique allows some flexibility in trading off stronger assumptions with computational complexity. For example, a parametric specification for the propensity score will be computationally easy, but will rely on distributional and functional form assumptions that may not be correct. On the other hand, nonparametric methods may be used that rely on less restrictive assumptions (though they do require some smoothness conditions on the propensity score), but they are likely to be more computationally complex.</p>
<div class="section level4">
<h4 id="estimation-1">Estimation<a class="anchor" aria-label="anchor" href="#estimation-1"></a>
</h4>
<p>Estimation of QTEs under the Conditional Independence Assumption can be performed using the command <code>ci.qte</code>, and estimation of the QTET can be performed with the command <code>ci.qtet</code>. With covariates, this command estimates unconditional QTEs using the propensity score re-weighting procedure of <span class="citation">(Firpo 2007)</span>. Without modification, the command estimates in a first stage the propensity score using a logit model where all the covariates enter in levels.</p>
<p>The following command estimates the QTE of the job training program using the observational data and conditioning on several available variables.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span> <span class="va">jt.cia</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ci.qte.html">ci.qte</a></span><span class="op">(</span><span class="va">re78</span> <span class="op">~</span> <span class="va">treat</span>,</span>
<span>   xformla<span class="op">=</span><span class="op">~</span><span class="va">age</span> <span class="op">+</span> <span class="va">education</span>,</span>
<span>   data<span class="op">=</span><span class="va">lalonde.psid</span>,</span>
<span>   probs<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0.05</span>,<span class="fl">0.95</span>,<span class="fl">0.05</span><span class="op">)</span>, se<span class="op">=</span><span class="cn">T</span>, iters<span class="op">=</span><span class="fl">10</span><span class="op">)</span></span>
<span> <span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">jt.cia</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## </span></span>
<span><span class="co">## Quantile Treatment Effect:</span></span>
<span><span class="co">##      </span></span>
<span><span class="co">## tau  QTE Std. Error</span></span>
<span><span class="co">## 0.05      0.00        0.00</span></span>
<span><span class="co">## 0.1       0.00        0.00</span></span>
<span><span class="co">## 0.15  -4433.18     1198.69</span></span>
<span><span class="co">## 0.2   -8219.15      718.36</span></span>
<span><span class="co">## 0.25 -10435.74     1054.95</span></span>
<span><span class="co">## 0.3  -12232.03      996.99</span></span>
<span><span class="co">## 0.35 -12428.30     1608.31</span></span>
<span><span class="co">## 0.4  -14195.24     2009.87</span></span>
<span><span class="co">## 0.45 -14248.66     1701.14</span></span>
<span><span class="co">## 0.5  -15538.67     2062.94</span></span>
<span><span class="co">## 0.55 -16550.71     2616.84</span></span>
<span><span class="co">## 0.6  -15595.02     2999.45</span></span>
<span><span class="co">## 0.65 -15827.52     2912.97</span></span>
<span><span class="co">## 0.7  -16090.32     2662.93</span></span>
<span><span class="co">## 0.75 -16091.49     3379.79</span></span>
<span><span class="co">## 0.8  -17864.76     4219.90</span></span>
<span><span class="co">## 0.85 -16756.71     4852.37</span></span>
<span><span class="co">## 0.9  -17914.99     4214.26</span></span>
<span><span class="co">## 0.95 -23646.22     3934.80</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Average Treatment Effect:    -13435.40</span></span>
<span><span class="co">##   Std. Error:        1821.48</span></span></code></pre>
<p>and the QTE can be plotted</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span> <span class="fu"><a href="../reference/ggqte.html">ggqte</a></span><span class="op">(</span><span class="va">jt.cia</span><span class="op">)</span></span></code></pre></div>
<p><img src="R-QTEs_files/figure-html/unnamed-chunk-9-1.png" width="90%" style="display: block; margin: auto;"></p>
<p>and next the QTET of the job training is computed under the same setup</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span> <span class="va">jt.ciat</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ci.qtet.html">ci.qtet</a></span><span class="op">(</span><span class="va">re78</span> <span class="op">~</span> <span class="va">treat</span>,</span>
<span>   xformla<span class="op">=</span><span class="op">~</span><span class="va">age</span> <span class="op">+</span> <span class="va">education</span>,</span>
<span>   data<span class="op">=</span><span class="va">lalonde.psid</span>,</span>
<span>   probs<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0.05</span>,<span class="fl">0.95</span>,<span class="fl">0.05</span><span class="op">)</span>, se<span class="op">=</span><span class="cn">T</span>, iters<span class="op">=</span><span class="fl">10</span><span class="op">)</span></span>
<span> <span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">jt.ciat</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## </span></span>
<span><span class="co">## Quantile Treatment Effect:</span></span>
<span><span class="co">##      </span></span>
<span><span class="co">## tau  QTE Std. Error</span></span>
<span><span class="co">## 0.05      0.00        0.00</span></span>
<span><span class="co">## 0.1   -1018.15      638.08</span></span>
<span><span class="co">## 0.15  -3251.00     1346.80</span></span>
<span><span class="co">## 0.2   -7240.86     1120.03</span></span>
<span><span class="co">## 0.25  -8379.94      607.30</span></span>
<span><span class="co">## 0.3   -8758.82      908.18</span></span>
<span><span class="co">## 0.35  -9897.44      980.34</span></span>
<span><span class="co">## 0.4  -10239.57     1134.72</span></span>
<span><span class="co">## 0.45 -10751.39     1236.01</span></span>
<span><span class="co">## 0.5  -10570.14     1038.85</span></span>
<span><span class="co">## 0.55 -11348.96      947.75</span></span>
<span><span class="co">## 0.6  -11550.84     1107.62</span></span>
<span><span class="co">## 0.65 -12203.56     1149.92</span></span>
<span><span class="co">## 0.7  -13277.72     1030.71</span></span>
<span><span class="co">## 0.75 -14011.74     1070.05</span></span>
<span><span class="co">## 0.8  -14373.95     1141.25</span></span>
<span><span class="co">## 0.85 -14499.18     1243.54</span></span>
<span><span class="co">## 0.9  -15008.63     2157.47</span></span>
<span><span class="co">## 0.95 -15954.05     1698.33</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Average Treatment Effect:    4266.19</span></span>
<span><span class="co">##   Std. Error:        510.82</span></span></code></pre>
<p>Finally, the QTET is plotted</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span> <span class="fu"><a href="../reference/ggqte.html">ggqte</a></span><span class="op">(</span><span class="va">jt.ciat</span><span class="op">)</span></span></code></pre></div>
<p><img src="R-QTEs_files/figure-html/unnamed-chunk-11-1.png" width="90%" style="display: block; margin: auto;"></p>
</div>
</div>
<div class="section level3">
<h3 id="difference-in-differences-methods">Difference in Differences Methods<a class="anchor" aria-label="anchor" href="#difference-in-differences-methods"></a>
</h3>
<p>In some applications the Conditional Indpendence Assumption may not hold. An alternative identifying assumption that the researcher may be interested in making is the following Distributional Difference in Differences Assumption</p>
<p><span class="math display">\[ \Delta Y_{0t} \perp D_t | X \]</span></p>
<p>This is the identifying assumption made in <span class="citation">(Fan and Yu 2012; Callaway and Li 2019)</span>. This is a direct extension of the ``parallel trends’’ assumption made in the Difference in Differences literature <span class="citation">(Abadie 2005)</span>.<br>
Note that these types of methods only identify the QTET (not the QTE). <span class="citation">(Callaway and Li 2019)</span> show that this assumption only identifies the QTET when the researcher has access to three periods of panel data.</p>
<div class="section level4">
<h4 id="estimation-2">Estimation<a class="anchor" aria-label="anchor" href="#estimation-2"></a>
</h4>
<p>Estimation using the method in <span class="citation">(Callaway and Li 2019)</span> is similar to the preceding methods. However, the user must now additionally specify some extra parameters: (i) <code>t</code>, <code>tmin1</code>, and <code>tmin2</code> are the three time periods, and (ii) the names of the columns in <code>data</code> containing the time period and an individual id are required to be passed in as <code>tname</code> and <code>idname</code>. <code>data</code> itself must now be a panel dataset containing individual-time period observations. For this section the <code>lalonde.psid</code> dataset (which contains one row for each individual and with two lags of earnings available) has been converted into the <code>lalonde.psid.panel</code> (which contains three rows of observations for each individual).</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">lalonde.psid.panel</span><span class="op">)</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"id"</span>, <span class="st">"year"</span>, <span class="st">"re"</span>, <span class="st">"treat"</span>,</span>
<span>  <span class="st">"age"</span>, <span class="st">"education"</span>, <span class="st">"black"</span>, <span class="st">"hispanic"</span>, <span class="st">"married"</span>, <span class="st">"nodegree"</span>, <span class="st">"u75"</span><span class="op">)</span><span class="op">]</span></span></code></pre></div>
<pre><code><span><span class="co">##   id year       re treat age education black hispanic married nodegree u75</span></span>
<span><span class="co">## 1  1 1978  9930.05     1  37        11     1        0       1        1   1</span></span>
<span><span class="co">## 2  2 1978  3595.89     1  22         9     0        1       0        1   1</span></span>
<span><span class="co">## 3  3 1978 24909.50     1  30        12     1        0       0        0   1</span></span>
<span><span class="co">## 4  4 1978  7506.15     1  27        11     1        0       0        1   1</span></span>
<span><span class="co">## 5  5 1978   289.79     1  33         8     1        0       0        1   1</span></span>
<span><span class="co">## 6  6 1978  4056.49     1  22         9     1        0       0        1   1</span></span></code></pre>
<p>The <span class="citation">(Callaway and Li 2019)</span> method can be invoked with the <code>panel.qtet</code> command:</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span> <span class="va">jt.pqtet</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/panel.qtet.html">panel.qtet</a></span><span class="op">(</span><span class="va">re</span> <span class="op">~</span> <span class="va">treat</span>, t<span class="op">=</span><span class="fl">1978</span>, tmin1<span class="op">=</span><span class="fl">1975</span>, tmin2<span class="op">=</span><span class="fl">1974</span>,</span>
<span>   tname<span class="op">=</span><span class="st">"year"</span>, idname<span class="op">=</span><span class="st">"id"</span>,</span>
<span>   data<span class="op">=</span><span class="va">lalonde.psid.panel</span>,</span>
<span>   probs<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0.05</span>,<span class="fl">0.95</span>,<span class="fl">0.05</span><span class="op">)</span>, se<span class="op">=</span><span class="cn">T</span>, iters<span class="op">=</span><span class="fl">10</span><span class="op">)</span></span>
<span> <span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">jt.pqtet</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## </span></span>
<span><span class="co">## Quantile Treatment Effect:</span></span>
<span><span class="co">##      </span></span>
<span><span class="co">## tau  QTE Std. Error</span></span>
<span><span class="co">## 0.05  4779.21     1077.47</span></span>
<span><span class="co">## 0.1   1987.35      632.20</span></span>
<span><span class="co">## 0.15   842.95      578.85</span></span>
<span><span class="co">## 0.2  -7366.04     1971.72</span></span>
<span><span class="co">## 0.25 -8449.96     2702.63</span></span>
<span><span class="co">## 0.3  -7992.15     1495.16</span></span>
<span><span class="co">## 0.35 -7429.21     1672.73</span></span>
<span><span class="co">## 0.4  -6597.37     1745.94</span></span>
<span><span class="co">## 0.45 -5519.45     1863.02</span></span>
<span><span class="co">## 0.5  -4702.88     1664.44</span></span>
<span><span class="co">## 0.55 -3904.52     1704.02</span></span>
<span><span class="co">## 0.6  -2741.80     1766.84</span></span>
<span><span class="co">## 0.65 -1507.31     1862.25</span></span>
<span><span class="co">## 0.7   -771.12     1935.15</span></span>
<span><span class="co">## 0.75   707.81     1708.49</span></span>
<span><span class="co">## 0.8    580.00      995.66</span></span>
<span><span class="co">## 0.85   821.75      743.91</span></span>
<span><span class="co">## 0.9   -250.77     1496.21</span></span>
<span><span class="co">## 0.95 -1874.54     2836.41</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Average Treatment Effect:    2326.51</span></span>
<span><span class="co">##   Std. Error:        929.87</span></span></code></pre>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span> <span class="fu"><a href="../reference/ggqte.html">ggqte</a></span><span class="op">(</span><span class="va">jt.pqtet</span><span class="op">)</span></span></code></pre></div>
<p><img src="R-QTEs_files/figure-html/unnamed-chunk-13-1.png" width="90%" style="display: block; margin: auto;"></p>
<p>In the most common Difference in Differences case with two periods of panel or repeated cross sectional data, <span class="citation">(Fan and Yu 2012)</span> shows that the Distributional Difference in Differences Assumption leads to partial identification of the QTET. In this case, a user can estimate these bounds using the method <code>bounds</code>:<a href="#fn3" class="footnote-ref" id="fnref3"><sup>3</sup></a></p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span> <span class="va">b1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/bounds.html">bounds</a></span><span class="op">(</span><span class="va">re</span> <span class="op">~</span> <span class="va">treat</span>, t<span class="op">=</span><span class="fl">1978</span>, tmin1<span class="op">=</span><span class="fl">1975</span>, data<span class="op">=</span><span class="va">lalonde.psid.panel</span>,</span>
<span>   idname<span class="op">=</span><span class="st">"id"</span>, tname<span class="op">=</span><span class="st">"year"</span><span class="op">)</span></span>
<span> <span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">b1</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## </span></span>
<span><span class="co">## Bounds on the Quantile Treatment Effect on the Treated:</span></span>
<span><span class="co">##      </span></span>
<span><span class="co">## tau  Lower Bound Upper Bound</span></span>
<span><span class="co">##         tau  Lower Bound Upper Bound</span></span>
<span><span class="co">##        0.05       -51.72           0</span></span>
<span><span class="co">##         0.1     -1220.84           0</span></span>
<span><span class="co">##        0.15      -1881.9           0</span></span>
<span><span class="co">##         0.2     -2601.32           0</span></span>
<span><span class="co">##        0.25     -2916.38      485.23</span></span>
<span><span class="co">##         0.3     -3080.16      943.05</span></span>
<span><span class="co">##        0.35     -3327.89     1505.98</span></span>
<span><span class="co">##         0.4     -3240.59     2133.59</span></span>
<span><span class="co">##        0.45     -2982.51     2616.84</span></span>
<span><span class="co">##         0.5     -3108.01      2566.2</span></span>
<span><span class="co">##        0.55     -3342.66     2672.82</span></span>
<span><span class="co">##         0.6      -3491.4      3065.7</span></span>
<span><span class="co">##        0.65     -3739.74     3349.74</span></span>
<span><span class="co">##         0.7     -4647.82     2992.03</span></span>
<span><span class="co">##        0.75     -4826.78     3219.32</span></span>
<span><span class="co">##         0.8      -5801.7     2702.33</span></span>
<span><span class="co">##        0.85     -6588.61     2499.41</span></span>
<span><span class="co">##         0.9     -8953.84     2020.84</span></span>
<span><span class="co">##        0.95    -14283.61      397.04</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Average Treatment Effect on the Treated: 2326.51</span></span></code></pre>
<p>and the bounds can be plotted</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span> <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">b1</span><span class="op">)</span> </span></code></pre></div>
<p><img src="R-QTEs_files/figure-html/unnamed-chunk-14-1.png" width="90%" style="display: block; margin: auto;"></p>
<p>Finally, the <code>QTE</code> package implements several other methods that base identification on a Difference in Differences-type assumption. Each of these methods achieve point identification when only two periods of repeated cross sectional data is available. First, the identifying assumption for Quantile Difference in Differences (implemented in the <code>QDiD</code> method) is</p>
<p><span class="math display">\[ F^{-1}_{Y_{0t}|D_t=1}(\tau) - F^{-1}_{Y_{0t-1}|D_t=1}(\tau) = F^{-1}_{Y_{0t}|D_t=0}(\tau) - F^{-1}_{Y_{0t-1}|D_t=0}(\tau) \]</span></p>
<p>From this expression, we notice that <span class="math inline">\(F^{-1}_{Y_{0t}|D_t=1}(\tau)\)</span> is the term that needs to be identified for identification of the QTET. The other terms are identified because (i) no one is treated (by assumption) in the first period and (ii) untreated potential outcomes are observed for the untreated group. Invoking a conditional on covariates version of this assumption is not straightforward. We do provide a method for invoking this assumption with covariates. First, a linear model with all the terms in <span class="math inline">\(X\)</span> is run and the residuals plus the predicted value of the group effect are recovered. Then, the unconditional version of the model is run on these terms.</p>
<p>Next, the identifying assumption for the Change in Changes model of <span class="citation">(Athey and Imbens 2006)</span> can be stated nonparametrically as</p>
<p><span class="math display">\[ F_{Y_{0t}|D_t=1}^{-1}(\tau) - F_{Y_{0t-1}|D_t=1}^{-1}(\tau) = F_{Y_{0t}|D_t=0}^{-1}(F_{Y_{0t-1}|D_t=0}(y)) - F_{Y_{0t-1}|D_t=0}^{-1}(F_{Y_{0t-1}|D_t=0}(y)) \]</span></p>
<p>Whereas QDiD treats time and group symmetrically, CiC treats time and group asymmetrically. The other advantage of computing QTET with this method is that it is invariant to the scale of the dependent variable. The Change in Changes model is implemented by the method <code>CiC</code>.</p>
<p>Finally, the identifying assumption for the Mean Difference in Differences model is</p>
<p><span class="math display">\[ F_{Y_{0t}|D_t=1}^{-1}(\tau) - F_{Y_{0t-1}|D_t=1}^{-1}(\tau) = E[Y_{0t} - Y_{0t-1} | D_t=0] \]</span></p>
<p>This assumption is restrictive in that it restricts the difference in the quantiles of the distribution of untreated potential outcomes for the treated group in periods <span class="math inline">\(t\)</span> and <span class="math inline">\(t-1\)</span> be the same for all values of <span class="math inline">\(\tau\)</span>.</p>
</div>
<div class="section level4">
<h4 id="estimation-3">Estimation<a class="anchor" aria-label="anchor" href="#estimation-3"></a>
</h4>
<p>The QTET for participating in the job training program is estimated using each of the three methods ddid2, QDiD, and CiC next.</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span>  <span class="va">jt.ddid2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ddid2.html">ddid2</a></span><span class="op">(</span><span class="va">re</span> <span class="op">~</span> <span class="va">treat</span>, t<span class="op">=</span><span class="fl">1978</span>, tmin1<span class="op">=</span><span class="fl">1975</span>,</span>
<span>    tname<span class="op">=</span><span class="st">"year"</span>, idname<span class="op">=</span><span class="st">"id"</span>,</span>
<span>    data<span class="op">=</span><span class="va">lalonde.psid.panel</span>,</span>
<span>    probs<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0.05</span>,<span class="fl">0.95</span>,<span class="fl">0.05</span><span class="op">)</span>, se<span class="op">=</span><span class="cn">T</span>, iters<span class="op">=</span><span class="fl">10</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">jt.ddid2</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## </span></span>
<span><span class="co">## Quantile Treatment Effect:</span></span>
<span><span class="co">##      </span></span>
<span><span class="co">## tau  QTE Std. Error</span></span>
<span><span class="co">## 0.05 10616.61     1039.48</span></span>
<span><span class="co">## 0.1   5019.83      332.66</span></span>
<span><span class="co">## 0.15  2388.12      261.21</span></span>
<span><span class="co">## 0.2   1033.23      262.24</span></span>
<span><span class="co">## 0.25   485.23      287.24</span></span>
<span><span class="co">## 0.3    943.05      251.90</span></span>
<span><span class="co">## 0.35   931.45      269.98</span></span>
<span><span class="co">## 0.4    945.35      607.51</span></span>
<span><span class="co">## 0.45  1205.88      429.10</span></span>
<span><span class="co">## 0.5   1362.11      392.98</span></span>
<span><span class="co">## 0.55  1279.05      719.15</span></span>
<span><span class="co">## 0.6   1618.13     1005.67</span></span>
<span><span class="co">## 0.65  1834.30      979.01</span></span>
<span><span class="co">## 0.7   1326.06     1037.50</span></span>
<span><span class="co">## 0.75  1586.35      833.80</span></span>
<span><span class="co">## 0.8   1256.09      778.26</span></span>
<span><span class="co">## 0.85   723.10      902.21</span></span>
<span><span class="co">## 0.9    251.36     1728.61</span></span>
<span><span class="co">## 0.95 -1509.92     2544.38</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Average Treatment Effect:    2326.51</span></span>
<span><span class="co">##   Std. Error:        497.97</span></span></code></pre>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span>  <span class="fu"><a href="../reference/ggqte.html">ggqte</a></span><span class="op">(</span><span class="va">jt.ddid2</span><span class="op">)</span></span></code></pre></div>
<p><img src="R-QTEs_files/figure-html/unnamed-chunk-15-1.png" width="90%" style="display: block; margin: auto;"></p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span>  <span class="va">jt.qdid</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/QDiD.html">QDiD</a></span><span class="op">(</span><span class="va">re</span> <span class="op">~</span> <span class="va">treat</span>, t<span class="op">=</span><span class="fl">1978</span>, tmin1<span class="op">=</span><span class="fl">1975</span>,</span>
<span>     tname<span class="op">=</span><span class="st">"year"</span>, idname<span class="op">=</span><span class="st">"id"</span>,</span>
<span>     data<span class="op">=</span><span class="va">lalonde.psid.panel</span>,</span>
<span>     probs<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0.05</span>,<span class="fl">0.95</span>,<span class="fl">0.05</span><span class="op">)</span>, se<span class="op">=</span><span class="cn">T</span>, iters<span class="op">=</span><span class="fl">10</span>, panel<span class="op">=</span><span class="cn">T</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">jt.qdid</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## </span></span>
<span><span class="co">## Quantile Treatment Effect:</span></span>
<span><span class="co">##      </span></span>
<span><span class="co">## tau  QTE Std. Error</span></span>
<span><span class="co">## 0.05     0.00        0.00</span></span>
<span><span class="co">## 0.1     64.45      613.85</span></span>
<span><span class="co">## 0.15   536.67      862.68</span></span>
<span><span class="co">## 0.2   -988.94      323.97</span></span>
<span><span class="co">## 0.25 -1194.26      581.05</span></span>
<span><span class="co">## 0.3   -287.93      458.10</span></span>
<span><span class="co">## 0.35    28.62      549.07</span></span>
<span><span class="co">## 0.4   -177.15      841.06</span></span>
<span><span class="co">## 0.45   578.25     1094.89</span></span>
<span><span class="co">## 0.5   1447.37      757.83</span></span>
<span><span class="co">## 0.55  2305.26      704.65</span></span>
<span><span class="co">## 0.6   3389.17      818.90</span></span>
<span><span class="co">## 0.65  3338.47      511.52</span></span>
<span><span class="co">## 0.7   4208.92      750.20</span></span>
<span><span class="co">## 0.75  4767.96     1156.77</span></span>
<span><span class="co">## 0.8   4649.06      902.82</span></span>
<span><span class="co">## 0.85  5075.03     1160.71</span></span>
<span><span class="co">## 0.9   4900.29     1971.45</span></span>
<span><span class="co">## 0.95  8915.09     2518.20</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Average Treatment Effect:    1684.96</span></span>
<span><span class="co">##   Std. Error:        779.91</span></span></code></pre>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span>  <span class="fu"><a href="../reference/ggqte.html">ggqte</a></span><span class="op">(</span><span class="va">jt.qdid</span><span class="op">)</span></span></code></pre></div>
<p><img src="R-QTEs_files/figure-html/unnamed-chunk-16-1.png" width="90%" style="display: block; margin: auto;"></p>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span>  <span class="va">jt.cic</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/CiC.html">CiC</a></span><span class="op">(</span><span class="va">re</span> <span class="op">~</span> <span class="va">treat</span>, t<span class="op">=</span><span class="fl">1978</span>, tmin1<span class="op">=</span><span class="fl">1975</span>,</span>
<span>    tname<span class="op">=</span><span class="st">"year"</span>, idname<span class="op">=</span><span class="st">"id"</span>,</span>
<span>    data<span class="op">=</span><span class="va">lalonde.psid.panel</span>,</span>
<span>    probs<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0.05</span>,<span class="fl">0.95</span>,<span class="fl">0.05</span><span class="op">)</span>, se<span class="op">=</span><span class="cn">T</span>, iters<span class="op">=</span><span class="fl">10</span>, panel<span class="op">=</span><span class="cn">T</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">jt.cic</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## </span></span>
<span><span class="co">## Quantile Treatment Effect:</span></span>
<span><span class="co">##      </span></span>
<span><span class="co">## tau  QTE Std. Error</span></span>
<span><span class="co">## 0.05     0.00        0.00</span></span>
<span><span class="co">## 0.1      0.00        0.00</span></span>
<span><span class="co">## 0.15     0.00        0.00</span></span>
<span><span class="co">## 0.2      0.00      153.44</span></span>
<span><span class="co">## 0.25   485.23      325.47</span></span>
<span><span class="co">## 0.3    929.88      376.87</span></span>
<span><span class="co">## 0.35  1460.36      486.14</span></span>
<span><span class="co">## 0.4   2321.11      894.55</span></span>
<span><span class="co">## 0.45  3462.56      782.79</span></span>
<span><span class="co">## 0.5   4232.31      743.75</span></span>
<span><span class="co">## 0.55  5010.34      927.41</span></span>
<span><span class="co">## 0.6   6210.67      904.05</span></span>
<span><span class="co">## 0.65  7458.11      873.58</span></span>
<span><span class="co">## 0.7   8173.91     1063.56</span></span>
<span><span class="co">## 0.75  9643.00     1216.90</span></span>
<span><span class="co">## 0.8   9860.76     2081.74</span></span>
<span><span class="co">## 0.85 10824.63     2308.16</span></span>
<span><span class="co">## 0.9   8670.99     2750.48</span></span>
<span><span class="co">## 0.95 11394.77     3102.93</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Average Treatment Effect:    5089.64</span></span>
<span><span class="co">##   Std. Error:        1009.14</span></span></code></pre>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span>  <span class="fu"><a href="../reference/ggqte.html">ggqte</a></span><span class="op">(</span><span class="va">jt.cic</span><span class="op">)</span></span></code></pre></div>
<p><img src="R-QTEs_files/figure-html/unnamed-chunk-17-1.png" width="90%" style="display: block; margin: auto;"></p>
</div>
</div>
</div>
<div class="section level2">
<h2 class="unnumbered" id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<div id="refs" class="references hanging-indent">
<div id="ref-abadie-2005">
<p>Abadie, Alberto. 2005. “Semiparametric Difference-in-Differences Estimators.” <em>The Review of Economic Studies</em> 72 (1): 1–19.</p>
</div>
<div id="ref-abadie-angrist-imbens-2002">
<p>Abadie, Alberto, Joshua Angrist, and Guido Imbens. 2002. “Instrumental Variables Estimates of the Effect of Subsidized Training on the Quantiles of Trainee Earnings.” <em>Econometrica</em> 70 (1): 91–117.</p>
</div>
<div id="ref-abbring-heckman-2007">
<p>Abbring, Jaap, and James Heckman. 2007. “Econometric Evaluation of Social Programs, Part Iii: Distributional Treatment Effects, Dynamic Treatment Effects, Dynamic Discrete Choice, and General Equilibrium Policy Evaluation.” <em>Handbook of Econometrics</em> 6: 5145–5303.</p>
</div>
<div id="ref-ashenfelter-1978">
<p>Ashenfelter, Orley. 1978. “Estimating the Effect of Training Programs on Earnings.” <em>The Review of Economics and Statistics</em>, 47–57.</p>
</div>
<div id="ref-athey-imbens-2006">
<p>Athey, Susan, and Guido Imbens. 2006. “Identification and Inference in Nonlinear Difference-in-Differences Models.” <em>Econometrica</em> 74 (2): 431–97.</p>
</div>
<div id="ref-callaway-li-2019">
<p>Callaway, Brantly, and Tong Li. 2019. “Quantile Treatment Effects in Difference in Differences Models with Panel Data.” <em>Quantitative Economics</em> 10 (4): 1579–1618.</p>
</div>
<div id="ref-dehejia-wahba-1999">
<p>Dehejia, Rajeev, and Sadek Wahba. 1999. “Causal Effects in Nonexperimental Studies: Reevaluating the Evaluation of Training Programs.” <em>Journal of the American Statistical Association</em> 94 (448): 1053–62.</p>
</div>
<div id="ref-fan-park-2009">
<p>Fan, Yanqin, and Sang Soo Park. 2009. “Partial Identification of the Distribution of Treatment Effects and Its Confidence Sets.” <em>Advances in Econometrics</em> 25: 3–70.</p>
</div>
<div id="ref-fan-yu-2012">
<p>Fan, Yanqin, and Zhengfei Yu. 2012. “Partial Identification of Distributional and Quantile Treatment Effects in Difference-in-Differences Models.” <em>Economics Letters</em> 115 (3): 511–15.</p>
</div>
<div id="ref-firpo-2007">
<p>Firpo, Sergio. 2007. “Efficient Semiparametric Estimation of Quantile Treatment Effects.” <em>Econometrica</em> 75 (1): 259–76.</p>
</div>
<div id="ref-frolich-melly-2013">
<p>Frolich, Markus, and Blaise Melly. 2013. “Unconditional Quantile Treatment Effects Under Endogeneity.” <em>Journal of Business &amp; Economic Statistics</em> 31 (3): 346–57.</p>
</div>
<div id="ref-heckman-smith-1995">
<p>Heckman, James J, and Jeffrey A Smith. 1995. “Assessing the Case for Social Experiments.” <em>The Journal of Economic Perspectives</em> 9 (2): 85–110.</p>
</div>
<div id="ref-heckman-robb-1985">
<p>Heckman, James, and Richard Robb. 1985. “Alternative Methods for Evaluating the Impact of Interventions.” In <em>Longitudinal Analysis of Labor Market Data</em>, edited by James Heckman and Burton Singer, 156–246. Cambridge: Cambridge University Press.</p>
</div>
<div id="ref-heckman-smith-clements-1997">
<p>Heckman, James, Jeffrey Smith, and Nancy Clements. 1997. “Making the Most Out of Programme Evaluations and Social Experiments: Accounting for Heterogeneity in Programme Impacts.” <em>The Review of Economic Studies</em> 64 (4): 487–535.</p>
</div>
<div id="ref-imbens-angrist-1994">
<p>Imbens, Guido, and Joshua Angrist. 1994. “Identification and Estimation of Local Average Treatment Effects.” <em>Econometrica</em>, 467–75.</p>
</div>
<div id="ref-imbens-wooldridge-2009">
<p>Imbens, Guido, and Jeffrey Wooldridge. 2009. “Recent Developments in the Econometrics of Program Evaluation.” <em>Journal of Economic Literature</em> 47 (1): 5–86.</p>
</div>
<div id="ref-lalonde-1986">
<p>LaLonde, Robert. 1986. “Evaluating the Econometric Evaluations of Training Programs with Experimental Data.” <em>American Economic Review</em>, 604–20.</p>
</div>
<div id="ref-smith-todd-2005">
<p>Smith, Jeffrey, and Petra Todd. 2005. “Does Matching Overcome Lalonde’s Critique of Nonexperimental Estimators?” <em>Journal of Econometrics</em> 125 (1): 305–53.</p>
</div>
</div>
</div>
<div class="footnotes">
<hr>
<ol>
<li id="fn1"><p>This type of assumption is typically called either Selection on Observables or a Conditional Independence assumption are handled by the <code>ci.qte</code> or <code>ci.qtet</code> methods using the method developed in <span class="citation">(Firpo 2007)</span>.<a href="#fnref1" class="footnote-back">↩︎</a></p></li>
<li id="fn2"><p>The R package <code>Matching</code> is available to estimate the ATE and the ATT using matching technques. In the <code>ci.qte</code> package, their are estimators of the ATE or ATT available as a by-product of estimating quantile treatment effects. These are typically based on re-weighting.<a href="#fnref2" class="footnote-back">↩︎</a></p></li>
<li id="fn3"><p>Currently, no standard errors or confidence intervals are computed using the <code>bounds</code> method.<a href="#fnref3" class="footnote-back">↩︎</a></p></li>
</ol>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by <a href="https://bcallaway11.github.io/" class="external-link">Brantly Callaway</a>.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.6.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
