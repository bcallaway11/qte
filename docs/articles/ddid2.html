<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ddid2 â€¢ qte</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/sandstone/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="ddid2">
<meta property="og:description" content="qte">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">qte</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">1.4.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../articles/index.html">User Guides</a>
</li>
<li>
  <a href="../reference/index.html">Functions</a>
</li>
<li>
  <a href="../news/index.html">News</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="ddid2_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>ddid2</h1>
                        <h4 data-toc-skip class="author">Brantly Callaway</h4>
            
            <h4 data-toc-skip class="date">2023-02-15</h4>
      
      
      <div class="hidden name"><code>ddid2.Rmd</code></div>

    </div>

    
    
<div class="section level2">
<h2 id="estimating-quantile-treatment-effects-using-callaway-li-and-oka-2018">Estimating Quantile Treatment Effects using Callaway, Li, and Oka (2018)<a class="anchor" aria-label="anchor" href="#estimating-quantile-treatment-effects-using-callaway-li-and-oka-2018"></a>
</h2>
<p>We are interested in estimating Conditional Quantile Treatment Effects on the Treated (QTT) with two periods of panel data (or repeated cross sections) under a Difference in Differences Assumption. These are defined by</p>
<p><span class="math display">\[ CQTT_x(\tau) = F^{-1}_{Y_{1t}|X=x,D=1}(\tau) - F^{-1}_{Y_{0t}|X=x,D=1}(\tau) \]</span></p>
<p>for <span class="math inline">\(\tau \in (0,1)\)</span> and where <span class="math inline">\(Y_{1t}\)</span> are treated potential outcomes in period <span class="math inline">\(t\)</span>, <span class="math inline">\(Y_{0t}\)</span> are untreated potential outcomes in period <span class="math inline">\(t\)</span> and <span class="math inline">\(D\)</span> indicates whether an individual is a member of the treated group or not. We are also thinking about the case where <span class="math inline">\(X\)</span> is discrete.</p>
<p>The identification challenge is to obtain the counterfactual conditional distribution of untreated potential outcomes for the treated group: <span class="math inline">\(F_{Y_{0t}|X=x, D=1}(y)\)</span>. This method is built for the standard DID case where a researcher has access to two periods of data, no one is treated in the first period <span class="math inline">\(t-1\)</span>, and the treated group is treated in period the last period <span class="math inline">\(t\)</span>.</p>
<p><strong>Assumption 1 (Distributional Difference in Differences)</strong></p>
<p><span class="math display">\[ \Delta Y_{0t} \perp D | X\]</span></p>
<p>This is an extension of the conditional mean DID assumption (<span class="math inline">\(E[\Delta Y_{0t}|X=x, D=1] = E[\Delta Y_{0t}|X=x,D=0]\)</span> to full independence. Relative to DID assumptions that are not conditional on <span class="math inline">\(X\)</span>, this assumption is nice as it allows the path of outcomes to depend on covariates. For example, suppose <span class="math inline">\(Y\)</span> is earnings. The path of earnings, in the absence of some treatment, is likely to depend on covariates such as education and age. If these are distributed differently across the treated and untreated groups, then an unconditional DID assumption is unlikely to hold, but Assumption 1 will.</p>
<p>Alone, Assumption 1 is not strong enough to identify the CQTT. We also impose the following additional assumption.</p>
<p><strong>Assumption 2 (Copula Invariance Assumption)</strong></p>
<p><span class="math display">\[ C_{\Delta Y_{0t}, Y_{0t-1} | X=x,D=1}(u,v) = C_{\Delta Y_{0t}, Y_{0t-1} | X=x,D=1}(u,v) \]</span></p>
<p>This assumption says that the dependence of the change in outcomes and the initial level of outcomes is the same for the treated group as the untreated group. To make things concrete, consider the earnings example again. The CI Assumption says that if we observe the biggest gains in earnings for the untreated group going to those with the highest initial earnings, then, in the absence of treatment, we would observe the same thing for the treated group. Under Assumption 1 and Assumption 2,</p>
<p><span class="math display">\[ F_{Y_{0t}|X=x,D=1}(y) = E[1\{\Delta Y_t + F^{-1}_{Y_{t-1}|X=x,D=1}(F^{-1}_{Y_{t-1}|X=x,D=1}(Y_{t-1})) \leq y\} | X=x, D=0] \]</span></p>
<p>And then we can invert this to obtain the CQTT.</p>
<p>The <code>ddid2</code> method contains the code to implement this method. Here is an example.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span> <span class="co">##load the package</span></span>
<span> <span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">qte</span><span class="op">)</span></span>
<span></span>
<span> <span class="co">##load the data</span></span>
<span> <span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">lalonde</span><span class="op">)</span></span>
<span></span>
<span> <span class="co">## Run the panel.qtet method on the experimental data with no covariates</span></span>
<span> <span class="va">dd1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ddid2.html">ddid2</a></span><span class="op">(</span><span class="va">re</span> <span class="op">~</span> <span class="va">treat</span>, t<span class="op">=</span><span class="fl">1978</span>, tmin1<span class="op">=</span><span class="fl">1975</span>, tname<span class="op">=</span><span class="st">"year"</span>,</span>
<span>  data<span class="op">=</span><span class="va">lalonde.psid.panel</span>, idname<span class="op">=</span><span class="st">"id"</span>, se<span class="op">=</span><span class="cn">FALSE</span>,</span>
<span>  probs<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0.05</span>, <span class="fl">0.95</span>, <span class="fl">0.05</span><span class="op">)</span><span class="op">)</span></span>
<span> <span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">dd1</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## </span></span>
<span><span class="co">## Quantile Treatment Effect:</span></span>
<span><span class="co">##      </span></span>
<span><span class="co">## tau  QTE</span></span>
<span><span class="co">## 0.05 10616.61</span></span>
<span><span class="co">## 0.1   5019.83</span></span>
<span><span class="co">## 0.15  2388.12</span></span>
<span><span class="co">## 0.2   1033.23</span></span>
<span><span class="co">## 0.25   485.23</span></span>
<span><span class="co">## 0.3    943.05</span></span>
<span><span class="co">## 0.35   931.45</span></span>
<span><span class="co">## 0.4    945.35</span></span>
<span><span class="co">## 0.45  1205.88</span></span>
<span><span class="co">## 0.5   1362.11</span></span>
<span><span class="co">## 0.55  1279.05</span></span>
<span><span class="co">## 0.6   1618.13</span></span>
<span><span class="co">## 0.65  1834.30</span></span>
<span><span class="co">## 0.7   1326.06</span></span>
<span><span class="co">## 0.75  1586.35</span></span>
<span><span class="co">## 0.8   1256.09</span></span>
<span><span class="co">## 0.85   723.10</span></span>
<span><span class="co">## 0.9    251.36</span></span>
<span><span class="co">## 0.95 -1509.92</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Average Treatment Effect:    2326.51</span></span></code></pre>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by <a href="https://bcallaway11.github.io/" class="external-link">Brantly Callaway</a>.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.6.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
