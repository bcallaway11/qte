<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>panel.qtet • qte</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="panel.qtet">
<meta property="og:description" content="qte">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">qte</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">1.3.1</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="../articles/index.html">Articles</a>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><link href="panel-qtet_files/anchor-sections-1.0/anchor-sections.css" rel="stylesheet">
<script src="panel-qtet_files/anchor-sections-1.0/anchor-sections.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>panel.qtet</h1>
                        <h4 class="author">Brantly Callaway</h4>
            
            <h4 class="date">2020-12-14</h4>
      
      
      <div class="hidden name"><code>panel-qtet.Rmd</code></div>

    </div>

    
    
<div id="estimating-quantile-treatment-effects-using-callaway-and-li-2016" class="section level1">
<h1 class="hasAnchor">
<a href="#estimating-quantile-treatment-effects-using-callaway-and-li-2016" class="anchor"></a>Estimating Quantile Treatment Effects using Callaway and Li (2016)</h1>
<p>The goal is to estimate the Quantile Treatment Effect on the Treated (QTET) which is given by</p>
<p><span class="math display">\[ F^{-1}_{Y_{1t}|D=1}(\tau) - F^{-1}_{Y_{0t}|D=1}(\tau) \]</span></p>
<p>for <span class="math inline">\(\tau \in (0,1)\)</span> and where <span class="math inline">\(Y_{1t}\)</span> are treated potential outcomes in period <span class="math inline">\(t\)</span>, <span class="math inline">\(Y_{0t}\)</span> are untreated potential outcomes in period <span class="math inline">\(t\)</span> and <span class="math inline">\(D\)</span> indicates whether an individual is a member of the treated group or not.</p>
<p>Thus, the key identification challenge is for the counterfactual distribution of untreated potential outcomes for the treated group <span class="math inline">\(F_{Y_{0t}|D=1}(y)\)</span> – once we identify this, we can invert it to get the quantiles.</p>
<p>We consider the case with three periods of panel data and where individuals are first treated in the last period – period <span class="math inline">\(t\)</span>. In period <span class="math inline">\(t-1\)</span>, <span class="math inline">\(Y_{it-1} = Y_{i0t-1}\)</span> and in period <span class="math inline">\(t-2\)</span>, Y_{it-2} = Y_{i0t-2}$ for all individuals; that is, in the first two periods no one is treated so that we observe everyone’s untreated potential outcomes.</p>
<p><strong>Assumption 1 (Distributional Difference in Differences)</strong></p>
<p><span class="math display">\[ \Delta Y_{0t} \perp D \]</span></p>
<p>This is an extension of the most common mean DID assumption (<span class="math inline">\(E[\Delta Y_{0t}|D=1] = E[\Delta Y_{0t}|D=0]\)</span> to full independence. But, unlike in the mean DID case, this assumption is not strong enough to point identify the QTET. We also invoke the following additional assumption.</p>
<p><strong>Assumption 2 (Copula Stability Assumption)</strong></p>
<p><span class="math display">\[ C_{\Delta Y_{0t}, Y_{0t-1} | D=1}(u,v) = C_{\Delta Y_{0t-1}, Y_{0t-2} | D=1}(u,v) \]</span></p>
<p>The CSA says that if, in the periods before treatment, we observe the largest gains in outcomes going to, say, those at the top of the distribution, then in the current period, we would also observe the same thing. Together, the Distributional DID Assumption and the Copula Stability Assumption imply that the counterfactual distribution of untreated potential outcomes for the treated group is identified. It is given by</p>
<p><span class="math display">\[ F_{Y_{0t}|D=1}(y) = E[1\{F^{-1}_{\Delta Y_{t}|D=0}(F_{\Delta Y_{t-1}|D=1}(\Delta Y_{t-1})) + F^{-1}_{Y_{t-1}|D=1}(F^{-1}_{Y_{t-2}|D=1}(Y_{t-2})) \leq y\} | D=1] \]</span></p>
<p>And then we can invert this to obtain the QTET.</p>
<p>We also can allow the Distributional DID Assumption to hold conditional on covariates. This may be important when the path of outcomes depends on covariates – for example, the path of earnings even in the absence of treatment is likely to depend on education, experience, etc. In this case, first step estimation depends on the propensity score, but is still straightforward. The <code>panel.qtet</code> contains all the tools needed to do the estimation.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"> <span class="co">##load the package</span>
 <span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">qte</span><span class="op">)</span>

 <span class="co">##load the data</span>
 <span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="va">lalonde</span><span class="op">)</span>

 <span class="co">## Run the panel.qtet method on the observational data with no covariates</span>
 <span class="va">pq1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/panel.qtet.html">panel.qtet</a></span><span class="op">(</span><span class="va">re</span> <span class="op">~</span> <span class="va">treat</span>, t<span class="op">=</span><span class="fl">1978</span>, tmin1<span class="op">=</span><span class="fl">1975</span>, tmin2<span class="op">=</span><span class="fl">1974</span>, tname<span class="op">=</span><span class="st">"year"</span>,
  x<span class="op">=</span><span class="cn">NULL</span>, data<span class="op">=</span><span class="va">lalonde.psid.panel</span>, idname<span class="op">=</span><span class="st">"id"</span>, se<span class="op">=</span><span class="cn">FALSE</span>,
  probs<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">0.1</span>, <span class="fl">0.9</span>, <span class="fl">0.1</span><span class="op">)</span><span class="op">)</span>
 <span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">pq1</span><span class="op">)</span></code></pre></div>
<pre><code>## 
## Quantile Treatment Effect:
##      
## tau  QTE
## 0.1   1987.35
## 0.2  -7366.04
## 0.3  -7992.15
## 0.4  -6597.37
## 0.5  -4702.88
## 0.6  -2741.80
## 0.7   -771.12
## 0.8    580.00
## 0.9   -250.77
## 
## Average Treatment Effect:    2326.51</code></pre>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"> <span class="co">## Run the panel.qtet method on the observational data conditioning on</span>
 <span class="co">## age, education, black, hispanic, married, and nodegree.</span>
 <span class="co">## The propensity score will be estimated using the default logit method.</span>
 <span class="va">pq2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/panel.qtet.html">panel.qtet</a></span><span class="op">(</span><span class="va">re</span> <span class="op">~</span> <span class="va">treat</span>, t<span class="op">=</span><span class="fl">1978</span>, tmin1<span class="op">=</span><span class="fl">1975</span>, tmin2<span class="op">=</span><span class="fl">1974</span>, tname<span class="op">=</span><span class="st">"year"</span>,
  xformla<span class="op">=</span><span class="op">~</span><span class="va">age</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/AsIs.html">I</a></span><span class="op">(</span><span class="va">age</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span> <span class="op">+</span> <span class="va">education</span> <span class="op">+</span> <span class="va">black</span> <span class="op">+</span> <span class="va">hispanic</span> <span class="op">+</span> <span class="va">married</span> <span class="op">+</span> <span class="va">nodegree</span>,
  data<span class="op">=</span><span class="va">lalonde.psid.panel</span>, idname<span class="op">=</span><span class="st">"id"</span>, se<span class="op">=</span><span class="cn">FALSE</span>,
  probs<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">0.1</span>, <span class="fl">0.9</span>, <span class="fl">0.1</span><span class="op">)</span><span class="op">)</span>
 <span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">pq2</span><span class="op">)</span></code></pre></div>
<pre><code>## 
## Quantile Treatment Effect:
##      
## tau  QTE
## 0.1      0.00
## 0.2  -2159.20
## 0.3  -3378.66
## 0.4  -2922.88
## 0.5  -1935.37
## 0.6    -88.03
## 0.7   1514.30
## 0.8   2633.73
## 0.9   3174.61
## 
## Average Treatment Effect:    401.65</code></pre>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Brantly Callaway.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
